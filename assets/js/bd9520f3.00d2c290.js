"use strict";(self.webpackChunkformal_land=self.webpackChunkformal_land||[]).push([[4900],{3500:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>n,metadata:()=>s,toc:()=>c});var i=o(4848),r=o(8453);const n={title:"\ud83c\udf32 What we do at Formal Land",tags:["security","formal verification","interactive theorem proving","Rust","Solidity"],authors:[]},a=void 0,s={permalink:"/blog/2024/10/13/class-what-we-do",source:"@site/blog/2024-10-13-class-what-we-do.md",title:"\ud83c\udf32 What we do at Formal Land",description:"In this blog post, we present what we do at Formal Land&nbsp;\ud83c\udf32, what tools and services we are developing to provide more security for our customers&nbsp;\ud83e\uddb8. We believe that for critical applications such as blockchains (L1, L2, dApps) you should always use the most advanced technologies to find bugs, otherwise bad actors will do and overtake you in the never-ending race for security&nbsp;\ud83c\udfce\ufe0f.",date:"2024-10-13T00:00:00.000Z",formattedDate:"October 13, 2024",tags:[{label:"security",permalink:"/blog/tags/security"},{label:"formal verification",permalink:"/blog/tags/formal-verification"},{label:"interactive theorem proving",permalink:"/blog/tags/interactive-theorem-proving"},{label:"Rust",permalink:"/blog/tags/rust"},{label:"Solidity",permalink:"/blog/tags/solidity"}],readingTime:6.75,hasTruncateMarker:!0,authors:[],frontMatter:{title:"\ud83c\udf32 What we do at Formal Land",tags:["security","formal verification","interactive theorem proving","Rust","Solidity"],authors:[]},unlisted:!1,prevItem:{title:"\ud83e\udd80 Formal verification of the type checker of Sui \u2013 part 2",permalink:"/blog/2024/10/14/verification-move-sui-type-checker-2"},nextItem:{title:"\ud83e\udd80 Formal verification of the type checker of Sui \u2013 part 1",permalink:"/blog/2024/08/19/verification-move-sui-type-checker-1"}},l={authorsImageUrls:[]},c=[{value:"Company",id:"company",level:2},{value:"Tools",id:"tools",level:2},{value:"\ud83d\udc2b\xa0coq-of-ocaml",id:"coq-of-ocaml",level:3},{value:"\ud83e\udd80\xa0coq-of-rust",id:"coq-of-rust",level:3},{value:"\ud83e\ude81\xa0coq-of-solidity",id:"coq-of-solidity",level:3},{value:"Conclusion",id:"conclusion",level:2}];function h(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(t.p,{children:["In this blog post, we present what we do at Formal Land\xa0\ud83c\udf32, what tools and services we are developing to provide more security for our customers\xa0\ud83e\uddb8. We believe that for critical applications such as blockchains (L1, L2, dApps) you should always ",(0,i.jsx)(t.strong,{children:"use the most advanced technologies to find bugs, otherwise bad actors will do"})," and overtake you in the never-ending race for security\xa0\ud83c\udfce\ufe0f."]}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Formal verification"})," is one of the best techniques to ensure that your code is correct, as it ",(0,i.jsx)(t.strong,{children:"checks every possible input\xa0\u2728"})," of your program. For a long, formal verification was reserved for specific fields, such as the space industry\xa0\ud83e\uddd1\u200d\ud83d\ude80. We are making this technology accessible for the blockchain industry and general programming thanks to tools and services we develop, like ",(0,i.jsx)(t.a,{href:"https://github.com/formal-land/coq-of-solidity",children:"coq-of-solidity"})," and ",(0,i.jsx)(t.a,{href:"https://github.com/formal-land/coq-of-rust",children:"coq-of-rust"}),"."]}),"\n",(0,i.jsxs)(t.admonition,{title:"Get started",type:"success",children:[(0,i.jsxs)(t.p,{children:["To ensure your code is secure today, contact us at\xa0",(0,i.jsx)(t.a,{href:"mailto:contact@formal.land",children:"\xa0\ud83d\udce7contact@formal.land"}),"!\xa0\ud83d\ude80"]}),(0,i.jsx)(t.p,{children:"Formal verification goes further than traditional audits to make 100% sure you cannot lose your funds. It can be integrated into your CI pipeline to make sure that every commit is correct without running a full audit again."}),(0,i.jsxs)(t.p,{children:["We make bugs such as the ",(0,i.jsx)(t.a,{href:"https://www.gemini.com/fr-fr/cryptopedia/the-dao-hack-makerdao",children:"DAO hack"})," ($60 million stolen) virtually impossible to happen again."]})]}),"\n",(0,i.jsx)("figure",{children:(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Forge in forest",src:o(3937).A+"",width:"1024",height:"1024"})})}),"\n",(0,i.jsx)(t.h2,{id:"company",children:"Company"}),"\n",(0,i.jsxs)(t.p,{children:["We have existed for ",(0,i.jsx)(t.strong,{children:"three years"}),", focusing on formal verification for the web3 industry to validate software\xa0\ud83d\udee1\ufe0f where safety is of paramount importance. ",(0,i.jsx)(t.strong,{children:"Formal verification"})," is a technique to analyze the code of a program, which relies on making a ",(0,i.jsx)(t.strong,{children:"mathematical proof that the code is correct"}),", proof that is furthermore checked by a computer\xa0\ud83e\udd13 to make sure there are absolutely no missing cases! As programs are made of 0 and 1 and fully deterministic, obtaining perfect programs is something we can reach."]}),"\n",(0,i.jsxs)(t.p,{children:["We need to rely on a proof system. We exclusively use the ",(0,i.jsx)(t.a,{href:"https://coq.inria.fr/",children:"\ud83d\udc13\xa0Coq"})," proof system as it is both:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"\ud83c\udf0c\xa0A generic proof system"})," We can represent any programming languages and security properties in Coq."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"\ud83d\udc95\xa0A well known system"})," Coq is taught in many universities and has a large community of users, with complex software such as the C compiler ",(0,i.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/CompCert",children:"CompCert"})," fully implemented and verified in it."]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["We choose to verify ",(0,i.jsx)(t.strong,{children:"existing\xa0\ud83d\uddff"})," code rather than to develop new code written in a style simplifying formal verification. This is generally harder, but it is also more useful for many of our customers who have already written code and want to ensure it is correct without rewriting it. Verifying the existing code also enables the verification of the optimizations, which generally involve low-level operations that would be forbidden when rewriting the code in a formal verification language."]}),"\n",(0,i.jsxs)(t.p,{children:["We verify the actual ",(0,i.jsx)(t.strong,{children:"\ud83c\udf0d\xa0implementation"})," of programs rather than a ",(0,i.jsx)(t.strong,{children:"\ud83d\uddfa\ufe0f\xa0model"})," of them. This is to capture all the implementation details, such as integer overflows or the use of specific data structures or libraries. We believe that a lot of bugs are hidden in the details (the devil is in the details), in addition to the high-level bugs of design. Verifying the implementation also helps to ",(0,i.jsx)(t.strong,{children:"follow code updates\xa0\ud83e\ude9c"})," as we are able to say that we verified the code for a precise commit hash."]}),"\n",(0,i.jsx)(t.h2,{id:"tools",children:"Tools"}),"\n",(0,i.jsx)(t.h3,{id:"coq-of-ocaml",children:"\ud83d\udc2b\xa0coq-of-ocaml"}),"\n",(0,i.jsxs)(t.p,{children:["The tool ",(0,i.jsx)(t.a,{href:"https://github.com/formal-land/coq-of-ocaml",children:"coq-of-ocaml"})," was our first product to analyze ",(0,i.jsx)(t.a,{href:"https://ocaml.org/",children:"\ud83d\udc2b\xa0OCaml"})," programs by translating the code to Coq. The translation is almost one-to-one in terms of size, for a verification work simplified at a maximum. It was initially developed as part of a PhD at ",(0,i.jsx)(t.a,{href:"https://inria.fr/",children:"Inria"})," and then at the ",(0,i.jsx)(t.a,{href:"https://www.nomadic-labs.com/",children:"\xa0Nomadic Labs"})," company."]}),"\n",(0,i.jsxs)(t.p,{children:["We use it to verify properties of the code of the Layer 1 of ",(0,i.jsx)(t.a,{href:"https://tezos.com/",children:"Tezos"})," with the project ",(0,i.jsx)(t.a,{href:"https://formal-land.gitlab.io/coq-tezos-of-ocaml/",children:"Coq Tezos of OCaml"}),". We analyzed a code base of more than 100,000 lines of OCaml code, for which we made a full and automatic translation to the proof system Coq that can be maintained as the code evolves. We verified various properties, including:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"The compatibility of the serialization/deserialization functions."}),"\n",(0,i.jsx)(t.li,{children:"The adequacy of the smart contract interpreter with the existing smart contract semantics."}),"\n",(0,i.jsx)(t.li,{children:"The preservation of various invariants on the data structures."}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["Many more properties are yet to be verified, but the project is currently on hold. You can have more information by looking at the ",(0,i.jsx)(t.a,{href:"https://formal-land.gitlab.io/coq-tezos-of-ocaml/blog",children:"project blog"}),"!"]}),"\n",(0,i.jsx)(t.h3,{id:"coq-of-rust",children:"\ud83e\udd80\xa0coq-of-rust"}),"\n",(0,i.jsxs)(t.p,{children:["Our second project is ",(0,i.jsx)(t.a,{href:"https://github.com/formal-land/coq-of-rust",children:"coq-of-rust"})," to verify Rust programs. Rust is an interesting target as more and more programs are getting written in it, especially for projects where the security is critical. Even if Rust offers a strong type system, with memory safe programs by design, there are still many bugs that can happen, like logical bugs or code making a panic (sudden stop of the program) in production due to an out-of-bound access in an array."]}),"\n",(0,i.jsxs)(t.p,{children:["The project ",(0,i.jsx)(t.code,{children:"coq-of-rust"})," was funded by ",(0,i.jsx)(t.a,{href:"https://alephzero.org/",children:"Aleph Zero"})," to verify the code of their smart contracts."]}),"\n",(0,i.jsxs)(t.p,{children:["We achieve to translate most Rust programs to the Coq proof system, including the ",(0,i.jsx)(t.code,{children:"core"})," library\xa0\ud83c\udf89, which is the standard library of Rust. To our knowledge, we are the only ones who have achieved such a translation of the standard library. The generated Coq code is about ten times the size of the initial Rust code. This is quite verbose and related in particular to:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"the expansion of macros,"}),"\n",(0,i.jsx)(t.li,{children:"the expansion of referencing/dereferencing operations that are often implicit in the source code,"}),"\n",(0,i.jsxs)(t.li,{children:["the expansion of ",(0,i.jsx)(t.code,{children:"match"})," patterns to primitive patterns."]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"We have a semantics for the translated code, and are working on reasoning principles to show that this translated code is equivalent to a much simpler version (simulations) on which to reason."}),"\n",(0,i.jsxs)(t.p,{children:["As an example, here is the Coq translation of one of the functions of the ",(0,i.jsx)(t.a,{href:"https://github.com/bluealloy/revm",children:"revm"}),", a Rust implementation of the Ethereum Virtual Machine:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-rust",children:'(*\npub fn add<H: Host + ?Sized>(interpreter: &mut Interpreter, _host: &mut H) {\n    gas!(interpreter, gas::VERYLOW);\n    pop_top!(interpreter, op1, op2);\n    *op2 = op1.wrapping_add( *op2);\n}\n*)\nDefinition add (\u03b5 : list Value.t) (\u03c4 : list Ty.t) (\u03b1 : list Value.t) : M :=\n  match \u03b5, \u03c4, \u03b1 with\n  | [], [ H ], [ interpreter; _host ] =>\n    ltac:(M.monadic\n      (let interpreter := M.alloc (| interpreter |) in\n      let _host := M.alloc (| _host |) in\n      M.catch_return (|\n        ltac:(M.monadic\n          (M.read (|\n            let~ _ :=\n              M.match_operator (|\n                M.alloc (| Value.Tuple [] |),\n                [\n                  fun \u03b3 =>\n                    ltac:(M.monadic\n                      (let \u03b3 :=\n                        M.use\n                          (M.alloc (|\n                            UnOp.not (|\n                              M.call_closure (|\n                                M.get_associated_function (|\n                                  Ty.path "revm_interpreter::gas::Gas",\n                                  "record_cost",\n                                  []\n                                |),\n                                [\n                                  M.SubPointer.get_struct_record_field (|\n                                    M.read (| interpreter |),\n                                    "revm_interpreter::interpreter::Interpreter",\n                                    "gas"\n                                  |);\n                                  M.read (|\n                                    M.get_constant (|\n                                      "revm_interpreter::gas::constants::VERYLOW"\n                                    |)\n                                  |)\n                                ]\n                              |)\n                            |)\n                          |)) in\n                      let _ :=\n                        M.is_constant_or_break_match (| M.read (| \u03b3 |), Value.Bool true |) in\n                      (* ... more code ... *)\n'})}),"\n",(0,i.jsx)(t.h3,{id:"coq-of-solidity",children:"\ud83e\ude81\xa0coq-of-solidity"}),"\n",(0,i.jsxs)(t.p,{children:["Last but not least, the tool ",(0,i.jsx)(t.a,{href:"https://github.com/formal-land/coq-of-solidity",children:"coq-of-solidity"})," to translate ",(0,i.jsx)(t.a,{href:"https://soliditylang.org/",children:"Solidity"})," smart contracts to Coq. We use the Yul intermediate language of the Solidity compiler to do our translation, with roughly a three times size increase in the translated code."]}),"\n",(0,i.jsxs)(t.p,{children:["We support most of the Solidity instructions, passing 90% of tests of the Solidity compiler. We recently developed a new translation mode that can represent arbitrary Solidity code, or Yul written by hand, in a nice monad, even in case of complex control flow like nested loops with ",(0,i.jsx)(t.code,{children:"break"})," and ",(0,i.jsx)(t.code,{children:"continue"})," instructions and variable mutations. This is done thanks to our new effect inference engine in ",(0,i.jsx)(t.code,{children:"coq-of-solidity"})," to always give a purely functional representation of imperative code."]}),"\n",(0,i.jsxs)(t.p,{children:["Compared to other formal analysis tools for Solidity, the strength is to be able to ",(0,i.jsx)(t.strong,{children:"verify arbitrary complex properties"}),". This is crucial for the verification of cryptographic operations (",(0,i.jsx)(t.strong,{children:"elliptic curve"})," implementations, ",(0,i.jsx)(t.strong,{children:"zero-knowledge verifiers"})," linking the L1 to the L2s, ...) that are out of reach of standard verification tools. For example, we are currently verifying a ",(0,i.jsx)(t.a,{href:"https://github.com/get-smooth/crypto-lib/blob/main/src/elliptic/SCL_mulmuladdX_fullgen_b4.sol",children:"hand-optimized Yul implementation"})," of elliptic curve operations."]}),"\n",(0,i.jsx)(t.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,i.jsxs)(t.p,{children:["We have seen what we are proposing at Formal Land to enhance the security of your applications to the best possible level\xa0\ud83c\udf1f, with security of mathematical certainty. Next time, we will see how to use the Coq proof system to verify simple properties by following the ",(0,i.jsx)(t.a,{href:"https://cel.hal.science/inria-00001173v6/file/coq-hurry.pdf",children:"Coq in a Hurry"})," tutorial\xa0\ud83d\ude80."]}),"\n",(0,i.jsx)(t.admonition,{title:"For more",type:"success",children:(0,i.jsx)(t.p,{children:(0,i.jsxs)(t.em,{children:["Follow us on ",(0,i.jsx)(t.a,{href:"https://x.com/FormalLand",children:"X"})," or ",(0,i.jsx)(t.a,{href:"https://fr.linkedin.com/company/formal-land",children:"LinkedIn"}),", or comment on this post below! Feel free to DM us for any services you need."]})})})]})}function d(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},3937:(e,t,o)=>{o.d(t,{A:()=>i});const i=o.p+"assets/images/forge-dcc490da4a4fe0beacd861afdfefd7d2.webp"},8453:(e,t,o)=>{o.d(t,{R:()=>a,x:()=>s});var i=o(6540);const r={},n=i.createContext(r);function a(e){const t=i.useContext(n);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(n.Provider,{value:t},e.children)}}}]);